# Теория к Лабораторной работе №4: Сложные запросы SQL

## 1. Сложные выборки (Complex Selections)

### Вложенные запросы (Subqueries)
Запросы, вложенные в другие запросы. Могут использоваться в `SELECT`, `FROM`, `WHERE`, `HAVING`.
*   **Скалярные подзапросы:** Возвращают одно значение.
*   **Табличные подзапросы:** Возвращают набор строк.
*   **Коррелированные подзапросы:** Используют значения из внешнего запроса.

### Операторы множеств
*   `UNION` / `UNION ALL`: Объединение результатов (с удалением дубликатов / без).
*   `INTERSECT`: Пересечение результатов.
*   `EXCEPT`: Разность результатов.

## 2. Соединения (JOINs)

*   `INNER JOIN`: Возвращает строки, имеющие совпадения в обеих таблицах.
*   `LEFT (OUTER) JOIN`: Все строки из левой таблицы + совпадения из правой (или NULL).
*   `RIGHT (OUTER) JOIN`: Все строки из правой таблицы + совпадения из левой.
*   `FULL (OUTER) JOIN`: Все строки из обеих таблиц.
*   `CROSS JOIN`: Декартово произведение (каждая строка с каждой).
*   `SELF JOIN`: Соединение таблицы с самой собой.

## 3. Группировка и Агрегация

*   `GROUP BY`: Группирует строки по значениям столбцов.
*   `HAVING`: Фильтрует группы (аналог WHERE для групп).
*   **Агрегатные функции:** `COUNT`, `SUM`, `AVG`, `MIN`, `MAX`.

## 4. Оконные функции (Window Functions)

Позволяют выполнять вычисления по набору строк, связанных с текущей строкой, не группируя их в одну строку вывода.
Синтаксис: `FUNCTION() OVER (PARTITION BY ... ORDER BY ...)`
*   `ROW_NUMBER()`, `RANK()`, `DENSE_RANK()`
*   `LAG()`, `LEAD()`
*   Агрегаты как оконные функции (`SUM() OVER ...`)

## 5. Сложные операторы

*   `EXISTS`: Проверяет, возвращает ли подзапрос хотя бы одну строку.
*   `CASE`: Условная логика в запросах (IF-THEN-ELSE).
*   `INSERT INTO ... SELECT`: Вставка данных из результата запроса.
*   `EXPLAIN`: Анализ плана выполнения запроса.
